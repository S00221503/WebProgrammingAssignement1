const mongoose = require('mongoose');
const Joi = require('joi'); // Make sure to require Joi

// Define your weather schema using Mongoose
const weatherSchema = new mongoose.Schema({
  location: {
    type: String,
    required: true,
    minlength: 3,
  },
  weather: String,
  chanceRain: Boolean,
  temperature: {
    type: Number,
    integer: true,
    min: 100,
  },
});

// Create the Weather model using the schema
const Weather = mongoose.model('weather', weatherSchema);

// Define the validation function (with an uppercase "V")
function ValidateWeather(weather) {
  const weatherJoiSchema = Joi.object({
    location: Joi.string().min(3).required(),
    weather: Joi.string(),
    chanceRain: Joi.boolean(),
    temperature: Joi.number().integer().min(100),
  });

  return weatherJoiSchema.validate(weather);
}

/*
mongoose
  .connect(connectionString, {
    useNewUrlParser: true,
    useUnifiedTopology: true,
  })
  .catch((error) => {
    console.log(`Database connection refused ${error}`);
    process.exit(2);
  });

const db = mongoose.connection;

db.on('error', console.error.bind(console, 'connection error:'));

db.once('open', () => {
  console.log('DB connected ' + connectionString);
});
*/

module.exports = { Weather, ValidateWeather };


